generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum NfeStatus {
  PROCESSING
  AUTHORIZED
  REJECTED
  ERROR
}

model Customer {
  id        String   @id @default(uuid())
  name      String
  cnpj      String   @unique
  ie        String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  nfes      Nfe[]
}

model Nfe {
  id                 String    @id @default(uuid())
  status             NfeStatus @default(PROCESSING)

  naturezaOperacao   String
  numero             Int
  serie              Int
  dataEmissao        DateTime

  customerId         String
  customer           Customer  @relation(fields: [customerId], references: [id])

  cfop               String
  cst                String

  totalValue         Decimal   @db.Decimal(12,2)

  xml                String?
  protocol           String?
  rejectionMsg       String?

  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  items              NfeItem[]

  @@unique([numero, serie]) // Evita duplicidade de NF
}

model NfeItem {
  id        String  @id @default(uuid())

  nfeId     String
  nfe       Nfe     @relation(fields: [nfeId], references: [id])

  codigo    String
  name      String
  ncm       String
  unidade   String

  quantity  Int
  unitPrice Decimal @db.Decimal(12,2)
  total     Decimal @db.Decimal(12,2)
}

model User {
  id         String    @id @default(uuid())
  name       String
  login      String    @unique
  password   String

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime?

  @@index([login])
}
